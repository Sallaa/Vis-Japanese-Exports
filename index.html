<html>
<meta charset="UTF-8">

<head>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://unpkg.com/topojson@3"></script>

<body>
  <h1 id="mainTitle"><span class="red">Japan</span>'s strategic exports to become a large economy</h1>
  <h1><span class="red">Japanese</span> exports in <u>1988</u></h1>
  <p id="vis"></p>

  <h1><span class="red">Japanese</span> exports in <u>2015</u></h1>
  <p id="vis2"></p>



  <h1><span class="red">Japan</span>'s exported goods</h1>
  <p id="top_description"> This chart shows the top 10 types of goods traded, and the economic benefit Japan gained from these goods, in 1988
    and 2015.</p>

  <p id="graph_01">
    <script>
      d3.csv("./dataset/overall.csv").then((data) => {


        var goods = [];
        var years = [1988, 2015];

        data.forEach((d, i) => {
          d['value'] = Number(d['Value_in_Yen']);
          d['year'] = Number(d['Year']);
          goods.push(d["hs2_name"]);
        });

        data = data.slice().sort((a, b) => d3.descending(a.value, b.value) && d3.ascending(a.year, b.year));

        var goods = [...new Set(goods)];
        // console.log(goods);

        console.log(data);

        var width = 960;
        var height = 600;
        var margin = {
          top: 40,
          bottom: 40,
          right: 40,
          left:40
        }
        var chartWidth = width - margin.left - margin.right;
        var chartHeight = height - margin.top - margin.bottom;
        var axisTicks = {
          qty: 5,
          outerSize: 0,
          dateFormat: '%y'
        };

        var svg = d3.select("#graph_01").append("svg")
          .attr("width", width)
          .attr("height", height)
          .style("-webkit-filter", "drop-shadow( 0px 10px 1rem #1c1e20)")
          .style("filter", "drop-shadow( 0px 10px 1rem #1c1e20)")
          .style("padding-bottom", "3rem")
          .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.append('rect')
          .attr('width', width)
          .attr('height', height)
          .attr("rx", 10)
          .attr("ry", 10)
          .attr('fill', '#1c1e20')
          .attr("transform", "translate(" + (-margin.left) + "," + (-margin.top) + ")");


        // Range round band learned from d3_noobs bar chart tutorial https://bl.ocks.org/d3noob/8952219

        var yearScale = d3.scaleBand()
          .domain(years)
          .rangeRound([0, chartHeight - 20])
          .paddingInner(0.1);

        var goodScale = d3.scaleBand()
          .domain(goods)
          .range([0, yearScale.bandwidth()])
          .padding(0.2);

        var valueScale = d3.scaleLinear().domain(d3.extent(data, d => d['value'])).range([0, chartWidth]);

        var goodScaleColor = d3.scaleOrdinal(d3.schemeTableau10);

        var xAxis = d3.axisBottom(valueScale).tickFormat(d3.format("$.0s")).tickSizeOuter(axisTicks.outerSize);
        var yAxis = d3.axisLeft(yearScale).tickSizeOuter(axisTicks.outerSize);
        let xGridlines = d3.axisBottom(valueScale)
          .tickSize(chartHeight)
          .tickFormat("")


        //X-axis
        svg.append("g")
          .attr("class", "x axis")
          .attr("transform", `translate(0,${chartHeight})`)
          .attr("stroke-width", '0.75')
          .attr("color", 'white')
          .call(xAxis);

        // Y-axis
        svg.append("g")
          .attr("class", "y axis")
          .call(yAxis)
          .attr("stroke-width", '0.75')
          .attr("color", 'white')
          .attr("font-size", 10);

        svg.append("g")
          .attr("class", "x grid")
          .attr("stroke-width", '0.75')
          .attr("color", 'white')
          .call(xGridlines);


        // Inspired heavily by Medium tutorial: https://medium.com/@vaibhavkumar_19430/how-to-create-a-grouped-bar-chart-in-d3-js-232c54f85894
        var yearGraph = svg.selectAll("#year")
          .data(data)
          .enter()
          .append("g")
          .attr("id", "year")
          .attr("transform", d => `translate(0, ${yearScale(d.Year)})`);


        var bars = yearGraph.selectAll(".bars")
          .data(d => [d])
          .enter()
          .append("rect")
          .attr("class", "bars")
          .attr('x', 1)
          .attr("y", d => goodScale(d.hs2_name) + 10)
          .style("fill", d => goodScaleColor(d.hs2_name))
          .attr("width", d => valueScale(d.value))
          .attr("height", goodScale.bandwidth());

        bars.selectAll("text")
          .data(d => [d])
          .enter()
          .append("text")
          .attr("x", 40)
          .attr("y", d => goodScale(d.hs2_name) + 5)
          .attr("text-anchor", "center")
          .text(d => d.good_type);


      }, (error) => {
        console.log("ERRORRRRR");
      });
    </script>
  </p>

</body>
<script src="maps.js"></script>

</html>